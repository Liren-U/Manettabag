---
// src/pages/index.astro
import Footer from "../components/Footer.astro";
import "../styles/global.css";

import ManettaBagHeader from "../components/ManettaBag-Header.astro";
import ManettaBagHeroBanner from "../components/ManettaBag-Hero-Banner.astro";
import ManettaBagHeroBannerMobile from "../components/ManettaBag-Hero-Banner-mobile.astro";
import ManettaBagMarqueeBanner from "../components/ManettaBag-MarqueeBanner.astro";
import ManettaBagFeaturePackLikePro from "../components/ManettaBag-Feature-PackLikePro.astro";
import ManettaBagFeatureComfort from "../components/ManettaBag-Feature-Comfort.astro";
import ManettaBagFeatureVideo from "../components/ManettaBag-Feature-Video.astro";
import ManettaBagSpecsIslands from "../components/ManettaBag-Specs-Islands.astro";
import ManettaBagSpecsIslandsTablet from "../components/ManettaBag-Specs-Islands-tablet.astro";
import ManettaBagFAQ from "../components/ManettaBag-FAQ.astro";
---

<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manetta Modular Bag</title>

    <link rel="canonical" href="https://manettabag.com/" />
    <link rel="icon" type="image/svg+xml" href="/manettabag-web-icon.svg" />
    <!-- 引用编译好的 Tailwind + 全局样式 -->
    <link rel="stylesheet" href="/tailwind.css" />
    <script is:inline>
      // 1. 立即生成 ID，确保全局可用
      if (!window.stape_pv_id) {
        window.stape_pv_id =
          "pv_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9);
      }
      if (!window.stape_reg_id) {
        window.stape_reg_id =
          "reg_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9);
      }
    </script>

    <script is:inline>
      // 2. Meta Pixel & CAPIG 核心逻辑
      !(function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod
            ? n.callMethod.apply(n, arguments)
            : n.queue.push(arguments);
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = "2.0";
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        // 必须确保这个链接在浏览器能直接打开
        t.src = "https://capig.manettabag.com/events.js";
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s);
      })(window, document, "script");

      fbq("init", "2248339528989623");
      fbq("track", "PageView", {}, { eventID: window.stape_pv_id });

      // 3. 首页转化逻辑（封装在函数中，确保在 DOM 加载后运行）
      window.addEventListener("load", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const email = urlParams.get("email");

        if (email && typeof fbq === "function") {
          console.log("[CAPI] 检测到 Email 参数，发送 CompleteRegistration");
          fbq(
            "track",
            "CompleteRegistration",
            {
              content_name: "Subscription",
              currency: "USD",
              value: 0.0,
              em: email,
            },
            { eventID: window.stape_reg_id }
          );
        }
      });
    </script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6D5EX8ZZ35"
    ></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-6D5EX8ZZ35");
    </script>
  </head>
  <body>
    {/*<Header />*/}

    <div id="top"></div>
    <ManettaBagHeader />

    <ManettaBagHeroBanner />

    <ManettaBagHeroBannerMobile />

    <ManettaBagMarqueeBanner />

    <main id="features" class="relative z-10 bg-dark-main pt-20">
      <ManettaBagFeaturePackLikePro />

      <ManettaBagFeatureComfort />

      <ManettaBagFeatureVideo />

      <ManettaBagSpecsIslands />

      <ManettaBagSpecsIslandsTablet />

      <ManettaBagFAQ />
      {/* 其他众筹模块将在这里添加，这些模块可能需要宽度限制 */}
    </main>

    <Footer />
  </body>
</html>

---
/**
 * ManettaBag-Hero-Banner-Mobile.astro
 * ğŸš€ æé€Ÿæ€§èƒ½ç‰ˆ - ç»ˆæç¨³å›ºä¿®å¤ï¼ˆç§»åŠ¨ç«¯ï¼‰
 * âœ… ç»å¯¹ä¸è·³è½¬ï¼šç‚¹å‡»æŒ‰é’® / å›è½¦ / ç¬¬ä¸‰æ–¹è§¦å‘ submit éƒ½ä¸ä¼šå» /vip-subscribe
 * âœ… ä¿æŒåŸåŠŸèƒ½ï¼šé‚®ç®±æ ¡éªŒ -> /api/klaviyo-subscribe -> dataLayer + fbq -> å¼¹çª— -> å…³é—­/å¤åˆ¶
 * âœ… ä¿®å¤ç‚¹ï¼šæŠŠ submit æŒ‰é’®æ”¹ä¸º buttonï¼Œå¹¶ç”¨ click/Enter è§¦å‘åŒä¸€è®¢é˜…å‡½æ•°
 * âœ… å…œåº•ï¼šæ•è·é˜¶æ®µæ‹¦æˆª submitï¼Œé˜»æ­¢å…¶å®ƒè„šæœ¬åœ¨ submit åè·³è½¬
 */
---

<style is:inline>
  /* åŸºç¡€å·¥å…·ç±» */
  .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: 0; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }

  /* --- ç§»åŠ¨ç«¯å¼¹çª—æ ·å¼ --- */
  #sharePopupMobile-v2.popup-overlay-mobile {
    display: none;
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.9);
    backdrop-filter: blur(8px);
    z-index: 9999;
    animation: popupFadeIn 0.3s ease;
    align-items: center;
    justify-content: center;
  }
  #sharePopupMobile-v2.popup-overlay-mobile.active { display: flex; }

  .popup-container-mobile {
    position: relative;
    width: 88%; max-width: 400px; max-height: 85vh;
    background: #fff; color: #1a1a1a;
    border-radius: 16px; box-shadow: 0 25px 50px rgba(0,0,0,0.5);
    display: flex; flex-direction: column; overflow: hidden;
  }

  .popup-header-img { height: 200px; width: 100%; background: #2a2a2a; position: relative; flex-shrink: 0; }
  .popup-header-img img { width: 100%; height: 100%; object-fit: cover; }

  .popup-badge {
    position: absolute; top: 15px; left: 15px;
    background: #c6a35d; color: white;
    padding: 4px 10px; font-size: 11px; font-weight: bold;
    border-radius: 4px; text-transform: uppercase;
    z-index: 2; box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  }

  .popup-content-scroll {
    padding: 25px 20px; overflow-y: auto;
    -webkit-overflow-scrolling: touch; flex: 1;
  }

  .popup-content-scroll h2 {
    font-family: 'Optima', 'Palatino', serif; font-size: 22px;
    margin: 0 0 10px 0; text-transform: uppercase;
    color: #1a1a1a; font-weight: bold; line-height: 1.2;
  }

  .popup-success-text {
    font-family: 'Optima', 'Palatino', serif; color: #dc2626;
    font-size: 26px; font-weight: bold; margin-top: 0; margin-bottom: 10px;
    text-transform: uppercase; letter-spacing: 0.02em; line-height: 1.2;
  }

  .reward-intro { color: #555; font-size: 13px; line-height: 1.5; margin-bottom: 20px; }
  .step-list { margin: 0 0 20px 0; padding: 0; list-style: none; }
  .step-item { display: flex; align-items: flex-start; margin-bottom: 10px; font-size: 12px; color: #333; line-height: 1.4; }
  .step-num {
    width: 18px; height: 18px; background: #1a1a1a; color: #fff;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-size: 10px; margin-right: 10px; margin-top: 1px; flex-shrink: 0;
  }

  .action-group-mobile { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
  .btn-share {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 12px 5px; border: 1px solid #ddd; text-decoration: none;
    color: #555; font-size: 10px; font-weight: bold; transition: 0.2s;
    border-radius: 8px; text-transform: uppercase; background: #fcfcfc; cursor: pointer;
  }
  .btn-share:active { background: #e5e5e5; transform: scale(0.98); }
  .btn-share svg { width: 20px; height: 20px; margin-bottom: 5px; fill: currentColor; }

  .action-group-mobile > :last-child {
    grid-column: span 2; flex-direction: row; background-color: #f3f3f3;
    padding: 14px; font-size: 11px; gap: 8px;
  }
  .action-group-mobile > :last-child svg { margin-bottom: 0; }

  .popup-footer {
    font-size: 10px; color: #999; border-top: 1px solid #eee;
    padding-top: 15px; margin-top: 5px; text-align: center;
  }

  .close-x-mobile {
    position: absolute; right: 15px; top: 15px;
    width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
    font-size: 20px; color: #1a1a1a; background: rgba(255,255,255,0.9);
    border-radius: 50%; border: none; z-index: 10; line-height: 1;
    cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  @keyframes popupFadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
</style>

<section class="relative w-full min-h-screen pt-32 pb-20 lg:pt-0 lg:pb-0 flex items-center overflow-hidden bg-dark-main lg:hidden">
  <div class="absolute top-[-30%] right-[-20%] w-[1000px] h-[1000px] bg-gradient-radial from-brand/20 to-transparent rounded-full blur-[150px] pointer-events-none opacity-60 transform-gpu translate-z-0 will-change-transform"></div>
  <div class="absolute bottom-[-20%] left-[-10%] w-[800px] h-[800px] bg-gradient-radial from-[#333]/30 to-transparent rounded-full blur-[120px] pointer-events-none transform-gpu translate-z-0 will-change-transform"></div>
  <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MDAiIGhlaWdodD0iNDAwIj48ZmlsdGVyIGlkPSJhIj48ZmVUdXJYdWxlbmNlIGJhc2VGcmVxdWVuY3k9Ii44IiBudW1PY3RhdmVzPSI0IiByZXN1bHQ9Im5vaXNlIi8+PGZlQ29sb3JNYXRyaXggdHlwZT0ic2F0dXJhdGUiIHZhbHVlXz0iMCIvPjxmZUNvbXBvbmVudFRyYW5zZmVyPjxmZUZ1bmHSPVR5cGU9ImxpbmVhciIgc2xvcGU9Ii4xIi8+PC9mZUNvbXBvbmVudFRyYW5zZmVyPjxmZUJsZW5kIG1vZGU9Im11bHRpcGx5IiBpbj0iU291cmNlR3JhcGhpYyIvPjwvZmlsdGVyPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbHRlcj0idXJsKCNhKSIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==')] opacity-20 pointer-events-none"></div>

  <div class="max-w-limit mx-auto px-6 lg:px-gutter w-full grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-12 items-center relative z-10">
    <div class="reveal active flex flex-col items-start">
      <div class="inline-flex items-center gap-3 px-4 py-2 rounded-full bg-white/5 border border-white/10 mb-10 backdrop-blur-md">
        <span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-brand opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-brand"></span></span>
        <span class="text-xs font-bold tracking-widest text-light-muted uppercase">Kickstarter Launching Soon</span>
      </div>

      <h1 class="font-display font-bold text-6xl lg:text-[6.5rem] leading-[0.9] tracking-tight mb-8 text-white">
        Redefine Your <br />
        <span class="text-white/40">Camera Bag</span>
      </h1>

      <p class="text-xl text-light-muted mb-12 max-w-md leading-relaxed">
        Meet <strong class="text-white">MANETTA</strong> â€” a 3-in-1 modular system that expands from 22L to 42L in seconds. One bag, built for every shoot.
      </p>
    </div>

    <div class="reveal delay-200 relative lg:h-screen flex flex-col lg:flex-row items-center justify-center gap-6 lg:gap-8 perspective-1000 active">
      <div class="relative w-full max-w-[750px] transform-style-3d animate-float-slow">
        <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-[80%] h-20 bg-brand/20 blur-[80px] rounded-full transform-gpu"></div>
        <img src="/images/Manetta-hero-banner-product.png" alt="Manetta Modular Backpack" class="w-full h-auto object-contain drop-shadow-[0_50px_80px_rgba(0,0,0,0.5)]" width="750" height="800" fetchpriority="high" loading="eager" decoding="async" />
      </div>

      <div class="w-full max-w-md p-[1px] rounded-2xl bg-gradient-to-br from-white/20 to-white/0">
        <div class="bg-dark-card/90 backdrop-blur-xl rounded-2xl p-8 relative overflow-hidden">
          <div class="absolute -top-20 -right-20 w-40 h-40 bg-brand/30 rounded-full blur-[60px] transform-gpu"></div>
          <div class="mb-2 relative">
            <div class="text-brand font-bold text-xs uppercase tracking-wider mb-2">Super Early Access Only</div>
            <div class="text-4xl font-display font-bold text-white">Get Over $100 OFF</div>
          </div>
          <div class="text-white font-bold text-xs tracking-wider mb-2">Enter your email to get in our Super Early Bird Deal.</div>

          {/* âœ… æ”¹åŠ¨ç‚¹ï¼šaction + novalidate + æŒ‰é’®æ”¹ä¸º type="button"ï¼ˆç»å¯¹ä¸èµ°åŸç”Ÿ submit å¯¼èˆªï¼‰ */}
          <form id="hero-form-mobile-v2" action="javascript:void(0)" novalidate class="flex flex-col lg:flex-row gap-3 relative">
            <input
              id="hero-email-mobile-v2"
              type="email"
              inputmode="email"
              autocomplete="email"
              placeholder="Your email address"
              class="w-full lg:flex-1 bg-white/5 border border-white/10 rounded-xl px-5 py-4 text-white placeholder-light-muted/50 focus:outline-none focus:border-brand/50 focus:bg-white/10 transition-all"
              required
            />
            <button
              id="hero-submit-btn-mobile-v2"
              type="button"
              class="w-full lg:w-auto bg-brand hover:bg-brand/90 text-white px-8 py-4 rounded-xl font-bold transition-all duration-300 shadow-glow flex items-center justify-center shrink-0 group whitespace-nowrap"
            >
              Reserve Now
            </button>
          </form>

          <br><div class="text-brand font-bold text-xs uppercase tracking-wider mb-2">We'll notify you the moment we go live.</div>
        </div>
      </div>
    </div>
  </div>

  <div id="sharePopupMobile-v2" class="popup-overlay-mobile">
    <div class="popup-container-mobile">
      <button id="popupCloseBtnMobile-v2" class="close-x-mobile" type="button">&times;</button>

      <div class="popup-header-img">
        <div class="popup-badge">FREE GIFT</div>
        <img src="/images/Manettabag-pop-mobile-1.png" alt="Custom ID Tag">
      </div>

      <div class="popup-content-scroll">
        <p class="popup-success-text">Congratulations you have subscribed.</p>
        <h2>Share & Get a Free Lens Protector</h2>
        <p class="reward-intro">Valid for backers only after supporting the campaign at launch.</p>
        <p>How to unlock your gift:</p>
        <ul class="step-list">
          <li class="step-item"><div class="step-num">1</div><div>Share this page with friends or on social media.</div></li>
          <li class="step-item"><div class="step-num">2</div><div>Email us a screenshot of your share.</div></li>
          <li class="step-item"><div class="step-num">3</div><div>We'll add a free lens protection Velcro cloth to your order â€” on us. It only takes a moment, and it helps us reach more creators like you.</div></li>
        </ul>

        <div class="action-group-mobile">
          <a href="https://www.facebook.com/sharer/sharer.php?u=manettabag.com" target="_blank" class="btn-share"><svg viewBox="0 0 24 24"><path d="M12 2.04C6.5 2.04 2 6.53 2 12.06C2 17.06 5.66 21.21 10.44 21.96V14.96H7.9V12.06H10.44V9.85C10.44 7.34 11.93 5.96 14.15 5.96C15.21 5.96 16.12 6.04 16.39 6.08V8.7H14.86C13.65 8.7 13.41 9.27 13.41 10.1V12.06H16.32L15.86 14.96H13.41V21.96C18.19 21.21 21.86 17.06 21.86 12.06C21.86 6.53 17.36 2.04 12 2.04Z"/></svg><span>Facebook</span></a>
          <a href="https://twitter.com/intent/tweet?text=Check%20out%20Manetta%20Bag&url=manettabag.com" target="_blank" class="btn-share"><svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg><span>Twitter</span></a>
          <a href="https://www.instagram.com/" target="_blank" class="btn-share"><svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg><span>Instagram</span></a>

          <button id="btn-copy-link-mobile-v2" class="btn-share" type="button"><svg viewBox="0 0 24 24"><path d="M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM19 21H8V7H19V21Z"/></svg><span id="copy-text-mobile">Copy Link</span></button>
        </div>

        <div class="popup-footer">Helping us reach more creators like you.</div>
      </div>
    </div>
  </div>
</section>

<script is:inline>
  (function () {
    const form = document.querySelector("#hero-form-mobile-v2");
    const popup = document.querySelector("#sharePopupMobile-v2");
    const closeBtn = document.querySelector("#popupCloseBtnMobile-v2");
    const copyBtn = document.querySelector("#btn-copy-link-mobile-v2");
    const submitBtn = document.querySelector("#hero-submit-btn-mobile-v2");
    const emailInput = document.querySelector("#hero-email-mobile-v2");

    // --- 1) å…³é—­å¼¹çª—ï¼šåªéšè—ï¼Œä¸è·³è½¬ ---
    const closePopupOnly = (e) => {
      if (e) { e.preventDefault(); e.stopPropagation(); }
      if (popup) popup.classList.remove("active");
    };

    if (closeBtn) closeBtn.onclick = closePopupOnly;
    if (popup) {
      popup.onclick = (e) => {
        if (e.target === popup) closePopupOnly(e);
      };
    }

    // --- 2) Copy Link ---
    if (copyBtn) {
      copyBtn.onclick = (e) => {
        e.preventDefault();
        const currentUrl = window.location.href;

        navigator.clipboard.writeText(currentUrl).then(() => {
          const originalHtml = copyBtn.innerHTML;
          copyBtn.innerHTML = `<svg viewBox="0 0 24 24" style="fill:#22c55e;"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg><span style="color:#22c55e;">Copied!</span>`;
          copyBtn.style.borderColor = "#22c55e";
          setTimeout(() => { copyBtn.innerHTML = originalHtml; copyBtn.style.borderColor = "#ddd"; }, 2000);
        }).catch(err => {
          console.error("Copy failed", err);
          alert("Please manually copy the URL.");
        });
      };
    }

    if (!form) return;

    // --- 3) ç»Ÿä¸€è®¢é˜…æµç¨‹ï¼ˆclick / Enter / submit éƒ½èµ°è¿™é‡Œï¼‰ ---
    let isSubmitting = false;

    async function subscribeFlow(e) {
      if (e) {
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
      }
      if (isSubmitting) return;

      const input = emailInput || form.querySelector("#hero-email-mobile-v2");
      const email = (input?.value || "").trim();
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (!emailPattern.test(email)) {
        alert("Please enter a valid email address.");
        input && input.focus();
        return;
      }

      const originalBtnText = submitBtn ? submitBtn.innerText : "";
      if (submitBtn) { submitBtn.disabled = true; submitBtn.innerText = "Subscribing..."; }
      isSubmitting = true;

      try {
        const res = await fetch("/api/klaviyo-subscribe", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email }),
        });

        const data = await res.json().catch(() => ({}));
        if (!res.ok || !data.success) {
          console.warn("[Hero subscribe mobile] failed:", data);
          alert(data.error || "Subscription failed, please try again.");
          return;
        }

        // âœ… GTM / Meta ä¿¡å·ï¼ˆä¸è·³è½¬ä¹Ÿèƒ½æŠ“åˆ°ï¼‰
        const eventId = (window.crypto && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now());
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push({ event: "lead", user_email: email, event_id: eventId });

        // âœ… FB Pixelï¼ˆå¯é€‰ï¼Œä¿ç•™ï¼‰
        if (typeof fbq === "function") {
          fbq("track", "Lead", {
            content_name: "Hero Banner Mobile Email Subscribe",
            source: "HomePageHeroMobile",
            eventID: eventId
          });
        }

        if (popup) popup.classList.add("active");
        form.reset();

      } catch (err) {
        console.error("[Hero subscribe mobile] error:", err);
        alert("Network error, please try again.");
      } finally {
        isSubmitting = false;
        if (submitBtn) { submitBtn.disabled = false; submitBtn.innerText = originalBtnText; }
      }
    }

    // âœ… ç‚¹å‡»æŒ‰é’®æäº¤ï¼ˆæŒ‰é’®æ˜¯ type="button"ï¼Œå¤©ç„¶ä¸è§¦å‘åŸç”Ÿ submitï¼‰
    if (submitBtn) {
      submitBtn.addEventListener("click", subscribeFlow, true);
    }

    // âœ… Enter æäº¤ï¼ˆä¿æŒåŸåŠŸèƒ½ï¼‰
    if (emailInput) {
      emailInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") subscribeFlow(e);
      }, true);
    }

    // âœ… å…œåº•ï¼šä»»ä½•äººè§¦å‘ submit éƒ½æ‹¦ä½ï¼ˆé˜²ç¬¬ä¸‰æ–¹è„šæœ¬/æ—§é€»è¾‘ï¼‰
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      e.stopPropagation();
      e.stopImmediatePropagation();
      subscribeFlow(e);
    }, true);
  })();
</script>

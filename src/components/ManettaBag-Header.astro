---
/*
  ManettaBag-Header.astro
  性能优化版：
  1. JS: 使用 requestAnimationFrame 优化滚动监听，防止掉帧。
  2. JS: 启用 { passive: true } 提升移动端滚动性能。
  3. CSS: 将 transition-all 改为具体属性，减少浏览器重绘负担。
  4. ✅ 新增功能：点击 Reserve Now 按钮触发 Hero 区域定义的弹窗
*/
---

<header
  id="navbar"
  class="fixed top-0 left-0 w-full z-50 border-b border-white/5 transition-[background-color,border-color,box-shadow,backdrop-filter] duration-500 ease-in-out will-change-[background-color,backdrop-filter]"
>
  <div
    class="max-w-limit mx-auto px-6 lg:px-gutter h-[88px] flex justify-between items-center transform-gpu"
  >
    <a href="https://manettabag.com" class="group" aria-label="Manetta Home">
      <div
        id="nav-logo"
        class="text-2xl font-display font-bold tracking-tighter text-white transition-colors duration-300 group-hover:text-brand"
      >
        MANETTA<span class="text-brand">.</span>
      </div>
    </a>

  </div>
</header>

<script is:inline>
  // 1. 获取元素
  const navbar = document.getElementById("navbar");
  const headerBtn = document.getElementById("header-reserve-btn");
  let ticking = false; // 节流锁

  if (navbar) {
    // --- 原有功能：滚动处理逻辑 ---
    const onScroll = () => {
      if (window.scrollY > 50) {
        navbar.classList.add("nav-scrolled");
        navbar.classList.remove("border-white/5");
      } else {
        navbar.classList.remove("nav-scrolled");
        navbar.classList.add("border-white/5");
      }
      ticking = false; // 解锁
    };

    window.addEventListener(
      "scroll",
      () => {
        if (!ticking) {
          // 请求下一帧执行，而不是立即执行
          window.requestAnimationFrame(onScroll);
          ticking = true; // 上锁
        }
      },
      { passive: true }
    ); // ⭐ 关键：告诉浏览器不阻止默认滚动，提升移动端流畅度
  }

  // --- ✅ 新增功能：点击 Header 按钮打开弹窗 ---
  if (headerBtn) {
    headerBtn.addEventListener("click", (e) => {
      e.preventDefault();

      // 获取 Hero 组件里的弹窗元素
      // 桌面端弹窗
      const desktopPopup = document.querySelector("#subscribePopup");
      const desktopInput = document.querySelector("#hero-email"); // 假设 Hero 里的输入框 ID

      // 移动端弹窗
      const mobilePopup = document.querySelector("#mobileSubscribePopup");
      const mobileInput = document.querySelector("#mobile-popup-email");

      // 判断当前屏幕宽度，决定打开哪个弹窗
      if (window.innerWidth < 1024 && mobilePopup) {
        // --- 移动端逻辑 ---
        mobilePopup.classList.add("active"); // 移动端使用 class 控制显示
        if (mobileInput) setTimeout(() => mobileInput.focus(), 100);
      } else if (desktopPopup) {
        // --- 桌面端逻辑 ---
        desktopPopup.style.display = "block"; // 桌面端使用 style 控制显示
        // 如果订阅弹窗里有输入框，聚焦它 (假设 ID 为 popup-email，根据你之前的代码)
        const popupInput = document.querySelector("#popup-email");
        if (popupInput) setTimeout(() => popupInput.focus(), 100);
      } else {
        // 如果找不到弹窗（比如不在首页），则回退到滚动到顶部
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    });
  }
</script>

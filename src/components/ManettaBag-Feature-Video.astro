---
/**
 * ManettaBag-Feature-Video.astro（最终保证可运行版）
 * 不依赖 Tailwind class 切换，完全用 inline style 控制显示隐藏
 */
---

<section id="video" class="py-40 bg-dark-main relative overflow-hidden">

  <div class="max-w-limit mx-auto px-6 lg:px-gutter text-center relative z-10">
    
    <span class="text-brand font-bold tracking-[0.3em] uppercase text-sm mb-8 block">
      Capacity Test
    </span>

    <h2 class="font-display font-bold text-5xl lg:text-6xl mb-20">
      What Fits Inside?
    </h2>

    <div class="relative w-full aspect-video rounded-[2.5rem] overflow-hidden border-2 border-brand/30 bg-dark-card">

      <!-- 视频 -->
      <video
        id="manetta-video"
        class="w-full h-full object-cover"
        controls
        playsinline
        webkit-playsinline
      >
        <source src="https://cdn.shopify.com/videos/c/o/v/f586f1d516e14c6c843580287f165454.mp4" type="video/mp4" />
        Your browser does not support HTML5 video.
      </video>

      <!-- 按钮（默认显示） -->
      <div
        id="video-overlay"
        style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; transition:opacity .3s; opacity:1;"
      >
        <div
          class="w-24 h-24 rounded-full bg-brand/20 backdrop-blur-md flex items-center justify-center border border-brand/40"
        >
          <svg class="w-10 h-10 text-white ml-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z" />
          </svg>
        </div>
      </div>

    </div>
  </div>
</section>

<script is:inline>
  const video = document.getElementById("manetta-video");
  const overlay = document.getElementById("video-overlay");

  if (video && overlay) {

    // 显示按钮
    const showOverlay = () => {
      overlay.style.opacity = "1";
      overlay.style.pointerEvents = "auto";
    };

    // 隐藏按钮
    const hideOverlay = () => {
      overlay.style.opacity = "0";
      overlay.style.pointerEvents = "none";
    };

    // 初始显示
    showOverlay();

    // 点击按钮播放
    overlay.addEventListener("click", () => {
      video.play();
    });

    // 视频开始播放 → 隐藏按钮
    video.addEventListener("play", () => {
      hideOverlay();
    });

    // 暂停 → 显示按钮
    video.addEventListener("pause", () => {
      if (!video.ended) {
        showOverlay();
      }
    });

    // 播放结束 → 回到0并显示按钮
    video.addEventListener("ended", () => {
      video.currentTime = 0;
      video.pause();
      showOverlay();
    });
  }
</script>

---
/**
 * ManettaBag-Feature-Video.astro
 * ğŸš€ æè‡´æ€§èƒ½ä¼˜åŒ–ç‰ˆ (Lighthouse Optimized)
 * 1. [Network] video æ·»åŠ  preload="none"ï¼Œå½»åº•é˜»æ­¢é¢„åŠ è½½æµé‡ã€‚
 * 2. [Lighthouse] å°† poster æ‹†åˆ†ä¸ºç‹¬ç«‹ <img> ä»¥æ”¯æŒ loading="lazy"ã€‚
 * 3. [Rendering] ä½¿ç”¨ content-visibility: auto è·³è¿‡å±å¹•å¤–æ¸²æŸ“ã€‚
 * 4. [UX] ä¿æŒå‘å…‰è¾¹æ¡† + æ’­æ”¾ç»“æŸé‡æ˜¾å°é¢ã€‚
 */
---

<style>
  /* === è¾¹æ¡†å‘¼å¸å‘å…‰ç‰¹æ•ˆ === */
  @keyframes video-pulse {
    0%, 100% {
      box-shadow: 0 0 20px -5px rgba(212, 106, 34, 0.2);
      border-color: rgba(212, 106, 34, 0.3);
    }
    50% {
      box-shadow: 0 0 50px -5px rgba(212, 106, 34, 0.6);
      border-color: rgba(212, 106, 34, 0.8);
    }
  }

  .video-glow {
    border-width: 2px;
    border-style: solid;
    animation: video-pulse 4s infinite ease-in-out;
  }
</style>

<section 
  id="video" 
  class="py-40 bg-dark-main relative overflow-hidden contain-layout"
  style="content-visibility: auto; contain-intrinsic-size: 800px;"
>

  <div class="max-w-limit mx-auto px-6 lg:px-gutter text-center relative z-10">
    
    <span class="text-brand font-bold tracking-[0.3em] uppercase text-sm mb-8 block animate-pulse">
      Capacity Test
    </span>

    <h2 class="font-display font-bold text-5xl lg:text-6xl mb-20">
      What Fits Inside?
    </h2>

    <div class="video-glow relative w-full aspect-video rounded-[2.5rem] overflow-hidden bg-dark-card">

      <video
        id="manetta-video"
        class="w-full h-full object-cover relative z-0"
        preload="none"
        controls
        playsinline
        webkit-playsinline
      >
        <source src="https://cdn.shopify.com/videos/c/o/v/f586f1d516e14c6c843580287f165454.mp4" type="video/mp4" />
        Your browser does not support HTML5 video.
      </video>

      <img 
        id="video-poster-img"
        src="/images/ManettaBag-Video.png" 
        alt="Manetta Bag Capacity Test Video Cover"
        class="absolute inset-0 w-full h-full object-cover z-10 transition-opacity duration-300"
        loading="lazy"
        decoding="async"
        fetchpriority="low"
      />

      <div
        id="video-overlay"
        class="absolute inset-0 flex items-center justify-center z-20 cursor-pointer transition-opacity duration-300"
      >
        <div
          class="w-24 h-24 rounded-full bg-brand/20 backdrop-blur-md flex items-center justify-center border border-brand/40 shadow-[0_0_30px_rgba(212,106,34,0.4)] transition-transform duration-300 hover:scale-110"
        >
          <svg class="w-10 h-10 text-white ml-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z" />
          </svg>
        </div>
      </div>

    </div>
  </div>
</section>

<script is:inline>
  const video = document.getElementById("manetta-video");
  const overlay = document.getElementById("video-overlay");
  const posterImg = document.getElementById("video-poster-img");

  if (video && overlay && posterImg) {

    // === æ˜¾ç¤ºçŠ¶æ€ (æŒ‰é’® + å°é¢) ===
    const showCover = () => {
      overlay.style.opacity = "1";
      overlay.style.pointerEvents = "auto";
      posterImg.style.opacity = "1"; // æ˜¾ç¤ºå°é¢
      posterImg.style.pointerEvents = "auto";
    };

    // === éšè—çŠ¶æ€ (å¼€å§‹æ’­æ”¾) ===
    const hideCover = () => {
      overlay.style.opacity = "0";
      overlay.style.pointerEvents = "none";
      posterImg.style.opacity = "0"; // éšè—å°é¢
      posterImg.style.pointerEvents = "none";
    };

    // ç‚¹å‡»æŒ‰é’® -> æ’­æ”¾
    overlay.addEventListener("click", () => {
      video.play();
    });

    // è§†é¢‘çœŸæ­£å¼€å§‹æ’­æ”¾ -> éšè—å°é¢å’ŒæŒ‰é’®
    video.addEventListener("play", () => {
      hideCover();
    });

    // æš‚åœ -> å¦‚æœæ²¡æ’­å®Œï¼Œæ˜¾ç¤ºæŒ‰é’®ï¼ˆä½†ä¸æ˜¾ç¤ºå°é¢ï¼Œä¿æŒç”»é¢ï¼‰
    video.addEventListener("pause", () => {
      if (!video.ended) {
        overlay.style.opacity = "1";
        overlay.style.pointerEvents = "auto";
      }
    });

    // æ’­æ”¾ç»“æŸ -> é‡ç½®è§†é¢‘ + æ˜¾ç¤ºå°é¢ + æ˜¾ç¤ºæŒ‰é’®
    video.addEventListener("ended", () => {
      // load() ä¼šé‡ç½®è§†é¢‘èµ„æºï¼Œè¿™å¯¹äºèŠ‚çœå†…å­˜å’Œé‡ç½®çŠ¶æ€å¾ˆæœ‰ç”¨
      // åœ¨ preload="none" ä¸‹ï¼Œå®ƒä¹Ÿä¼šåœæ­¢ç¼“å†²
      video.load(); 
      showCover();
    });
  }
</script>
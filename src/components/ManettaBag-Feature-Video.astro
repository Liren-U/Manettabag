---
/**
 * ManettaBag-Feature-Video.astro
 * 容量测试视频区块：What Fits Inside?
 */
---

<section
  id="video"
  class="py-40 bg-dark-main relative overflow-hidden"
>
  <!-- 背景橙色虚光 -->
  <div
    class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[80%] h-[50%] bg-brand/20 blur-[200px] rounded-full pointer-events-none opacity-40"
  ></div>

  <div
    class="max-w-limit mx-auto px-6 lg:px-gutter text-center relative z-10"
  >
    <span
      class="text-brand font-bold tracking-[0.3em] uppercase text-sm mb-8 block animate-pulse"
    >
      Capacity Test
    </span>

    <h2
      class="font-display font-bold text-5xl lg:text-6xl mb-20"
    >
      What Fits Inside?
    </h2>

    <!-- 视频容器 -->
    <div
      class="reveal active relative w-full aspect-video rounded-[2.5rem] overflow-hidden border-2 border-brand/30 bg-dark-card shadow-glow"
    >
      <video
        id="manetta-video"
        class="w-full h-full object-cover"
        controls
        poster=""
      >
        <source
          src="https://cdn.shopify.com/videos/c/o/v/f586f1d516e14c6c843580287f165454.mp4"
          type="video/mp4"
        />
        Your browser does not support HTML5 video.
      </video>

      <!-- 中间的圆形播放按钮（暂停/初始/播放结束时显示） -->
      <div
        id="video-overlay"
        class="absolute inset-0 flex items-center justify-center bg-transparent transition-opacity duration-300 opacity-100"
      >
        <div
          class="w-24 h-24 rounded-full bg-brand/20 backdrop-blur-md flex items-center justify-center border border-brand/40"
        >
          <svg
            class="w-10 h-10 text-white ml-2"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path d="M8 5v14l11-7z" />
          </svg>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- 交互逻辑：只改透明度 & pointer-events，不动 display，也不再用 video.load() -->
<script is:inline>
  const video = document.getElementById("manetta-video");
  const overlay = document.getElementById("video-overlay");

  if (video && overlay) {
    const setOverlayVisible = (visible) => {
      if (visible) {
        overlay.classList.remove("opacity-0", "pointer-events-none");
      } else {
        overlay.classList.add("opacity-0", "pointer-events-none");
      }
    };

    // 初始：显示按钮
    setOverlayVisible(true);

    // 点击按钮：开始播放（按钮本身不需要再主动 hide，play 事件会处理）
    overlay.addEventListener("click", () => {
      video.play();
    });

    // 视频开始播放：隐藏按钮
    video.addEventListener("play", () => {
      setOverlayVisible(false);
    });

    // 视频暂停：显示按钮（但不重置进度）
    video.addEventListener("pause", () => {
      if (!video.ended) {
        setOverlayVisible(true);
      }
    });

    // 视频播放结束：回到 0 秒并显示按钮（不再调用 video.load()，避免闪烁）
    video.addEventListener("ended", () => {
      video.currentTime = 0;
      video.pause();
      setOverlayVisible(true);
    });
  }
</script>

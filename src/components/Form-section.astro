---
/**
 * Form-section.astro
 * ✅ 容器 1: 电脑端 (无背景/边框/圆角, 左右并排, 输入框色值 rgba(163, 163, 163, 0.5))
 * ✅ 容器 2: 非电脑端 (独立卡片, 自然左对齐, 输入框同色)
 * ✅ 按钮文字: Subscribe Now
 */
---

<style>
  /* --- 1. 严格物理隔离逻辑 --- */
  @media (min-width: 1024px) {
    .container-1-desktop {
      display: flex !important;
      width: 100%;
      justify-content: center;
      align-items: center;
    }
    .container-2-mobile {
      display: none !important;
    }
  }

  @media (max-width: 1023.98px) {
    .container-1-desktop {
      display: none !important;
    }
    .container-2-mobile {
      display: block !important;
      width: 100%;
      padding: 2rem 1.5rem;
    }
  }

  /* --- 2. 容器 1 (电脑端) 布局 --- */
  .desktop-inner-layout {
    width: 100%;
    max-width: 1400px;
    display: flex;
    justify-content: center; 
    gap: 8rem; 
    align-items: center;
    padding: 2rem 0;
    /* 彻底移除大容器装饰 */
    background: transparent !important;
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
  }

  .left-content-zone {
    flex: 0 1 auto;
    max-width: 500px;
    text-align: left;
  }

  .right-form-zone {
    flex: 0 1 600px;
  }

  .desktop-form-row {
    display: flex;
    gap: 0.75rem;
    width: 100%;
  }

  /* --- 3. 输入框与按钮细节 --- */
  .input-custom {
    /* 核心修改：使用 rgba(163, 163, 163, 0.5) */
    background-color: rgba(163, 163, 163, 0.5) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    color: white;
  }
  .input-custom::placeholder {
    color: rgba(255, 255, 255, 0.6);
  }
  .input-custom:focus {
    border-color: #D46A22 !important;
    background-color: rgba(163, 163, 163, 0.6) !important;
    outline: none;
  }

  .mobile-inner-card {
    background-color: #111111;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 1.5rem;
    padding: 2.5rem;
    width: 100%;
    max-width: 450px;
  }

  /* --- 4. 弹窗样式 --- */
  .popup-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(8px);
    z-index: 9999;
  }
  .popup-container {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 90%; max-width: 850px;
    background: #fff; border-radius: 8px; overflow: hidden; display: flex;
  }
  .popup-left { flex: 1; background: #2a2a2a; min-height: 400px; display: flex; align-items: center; justify-content: center; }
  .popup-right { flex: 1.3; padding: 40px; color: #1a1a1a; display: flex; flex-direction: column; justify-content: center; }
  .close-x { position: absolute; right: 15px; top: 10px; font-size: 28px; cursor: pointer; color: #999; border: none; background: none; z-index: 10; }
</style>

<div class="form-section-root w-full">

  <div class="container-1-desktop py-12 px-6">
    <div class="desktop-inner-layout">
      <div class="left-content-zone relative z-10">
        <div class="text-[#D46A22] font-bold text-xs uppercase tracking-[0.3em] mb-4">Super Early Bird Access</div>
        <h2 class="text-4xl xl:text-5xl font-bold text-white mb-4 leading-tight tracking-tight">Get 34% OFF</h2>
        <p class="text-white/60 text-lg font-light leading-relaxed">
          Enter your email to unlock the massive discount right now.
        </p>
      </div>

      <div class="right-form-zone relative z-10">
        <form class="hero-form desktop-form-row">
          <input
            type="email"
            placeholder="Your email address"
            class="hero-email input-custom flex-1 rounded-xl px-6 py-4 text-white transition-all text-base"
            required
          />
          <button
            type="submit"
            class="hero-submit-btn bg-[#D46A22] hover:bg-[#D46A22]/90 text-white px-8 py-4 rounded-xl font-bold text-lg tracking-[0.1em] transition-all whitespace-nowrap"
          >
            Subscribe Now
          </button>
        </form>
      </div>
    </div>
  </div>

  <div class="container-2-mobile">
    <div class="mobile-inner-card">
      <div class="text-left flex flex-col gap-8 relative z-10">
        <div>
          <div class="text-[#D46A22] font-bold text-xs uppercase tracking-widest mb-3">Super Early Bird Access</div>
          <h2 class="text-4xl font-bold text-white mb-4 leading-tight tracking-tight">Get 34% OFF</h2>
          <p class="text-white/70 text-sm leading-relaxed">Enter your email to unlock the massive discount right now.</p>
        </div>
        <form class="hero-form flex flex-col gap-3 w-full">
          <input
            type="email"
            placeholder="Your email address"
            class="hero-email input-custom w-full rounded-xl px-5 py-4 text-white transition-all"
            required
          />
          <button type="submit" class="hero-submit-btn w-full bg-[#D46A22] text-white py-4 rounded-xl font-bold uppercase tracking-wider text-sm">Subscribe Now</button>
        </form>
        <div class="text-[#D46A22] font-bold text-[10px] uppercase tracking-widest">We'll notify you the moment we go live.</div>
      </div>
    </div>
  </div>

  <div id="sharePopup" class="popup-overlay">
    <div class="popup-container">
      <button id="popupCloseBtn" class="close-x">&times;</button>
      <div class="popup-left"><img src="/images/Manettabag-pop-desktop.png" alt="Free Gift" style="width:100%; height:100%; object-fit:cover;"></div>
      <div class="popup-right">
        <p style="color:#dc2626; font-weight:bold; font-size:24px; text-transform:uppercase; margin:0;">Success!</p>
        <h2 style="font-size:24px; margin:10px 0;">Share & Get a Free Gift</h2>
        <p style="color:#666; font-size:14px; margin-bottom:20px;">A versatile wrap to protect any device.</p>
        <button id="btn-copy-link" style="padding:15px; border:1px solid #ddd; background:#f9f9f9; font-weight:bold; cursor:pointer; border-radius:6px;">Copy Link</button>
      </div>
    </div>
  </div>
</div>

<script is:inline>
  (function () {
    const forms = document.querySelectorAll(".hero-form");
    const popup = document.querySelector("#sharePopup");
    const closeBtn = document.querySelector("#popupCloseBtn");
    const copyBtn = document.querySelector("#btn-copy-link");
    let submittedEmail = "";

    const proceedToNextPage = () => {
      window.location.href = "/vip-subscribe?email=" + encodeURIComponent(submittedEmail);
    };

    if (closeBtn) closeBtn.addEventListener("click", proceedToNextPage);
    if (popup) popup.addEventListener("click", (e) => { if (e.target === popup) proceedToNextPage(); });

    if (copyBtn) {
      copyBtn.addEventListener("click", () => {
        navigator.clipboard.writeText(window.location.href).then(() => {
          const original = copyBtn.innerText;
          copyBtn.innerText = "Copied!";
          setTimeout(() => { copyBtn.innerText = original; }, 2000);
        });
      });
    }

    forms.forEach(form => {
      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        const input = form.querySelector(".hero-email");
        const email = (input?.value || "").trim();
        try {
          const res = await fetch("/api/klaviyo-subscribe", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email }),
          });
          const data = await res.json().catch(() => ({}));
          if (!res.ok || !data.success) { alert("Subscription failed."); return; }
          submittedEmail = email;
          if (popup) popup.style.display = "block";
          else proceedToNextPage();
        } catch (err) { alert("Network error."); }
      });
    });
  })();
</script>